{% extends "base.html" %}
{% block title %}Admin â€“ Announcements{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Manage Announcements</h1>
    <p class="subtitle">Create and manage clinic-wide or role-specific notices</p>
</div>

<!-- Create Form -->
<div class="announcement-form">
    <form method="POST" id="announcement-form">
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" name="title" id="title" placeholder="e.g., Staff Meeting Tomorrow" required>
        </div>
        <div class="form-group">
            <label for="message">Message</label>
            <textarea name="message" id="message" placeholder="Write your announcement..." required></textarea>
        </div>
        <div class="form-group">
            <label for="category">Category</label>
            <select name="category" id="category" required>
                <option value="">-- Select --</option>
                <option value="general">General</option>
                <option value="urgent">Urgent</option>
                <option value="policy">Policy</option>
                <option value="meeting">Meeting</option>
            </select>
        </div>
        <div class="form-group">
            <label for="target_role">Target Audience</label>
            <select name="target_role" id="target_role" required>
                <option value="all">All Staff</option>
                <option value="doctor">Doctors Only</option>
                <option value="nurse">Nurses Only</option>
                <option value="receptionist">Receptionists Only</option>
            </select>
        </div>
        <div class="form-group checkbox">
            <label><input type="checkbox" name="pinned" id="pinned"> Pin to top</label>
        </div>
        <button type="submit" class="btn btn-primary">Create Announcement</button>
    </form>

    <!-- Live Preview -->
    <div class="card" id="preview-card" style="margin-top: 1.5rem; display: none;">
        <h3>Preview</h3>
        <div id="preview-content" style="padding: 0.5rem 0;"></div>
    </div>
</div> {# <-- THIS WAS MISSING #}

<!-- List -->
<div class="card">
    <h2>Existing Announcements</h2>
    {% if announcements %}
    <ul class="announcements-list">
        {% for a in announcements %}
        <li class="announcement-item {% if a.pinned %}pinned{% endif %}">
            <div class="announcement-header">
                <h3>{{ a.title }}</h3>
                <div class="announcement-meta">
                    <span class="author">{{ a.author }}</span>
                    <span class="timestamp">{{ a.timestamp }}</span>
                    <span class="badge">{{ a.category | capitalize }}</span>
                    <span class="target-role">
                        {% if a.target_role == 'all' %}All{% else %}{{ a.target_role | capitalize }}{% endif %}
                    </span>
                    {% if a.pinned %}<i class="fas fa-thumbtack pinned-icon" title="Pinned"></i>{% endif %}
                </div>
            </div>
            <div class="announcement-body">
                <p>{{ a.message | nl2br | safe }}</p>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-bell-slash"></i>
        <p>No announcements yet. Create one above!</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  {% if request.path == '/announcements' %}
    <script src="{{ url_for('static', filename='js/admin.js') }}?v=1"></script>
  {% endif %}
{% endblock %}
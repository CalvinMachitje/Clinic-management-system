{% extends "base.html" %}
{% block title %}System Settings - Township Clinic{% endblock %}
{% block content %}
        <div class="dashboard-content">
            <form id="settings-form" action="{{ url_for('save_settings') }}" method="POST" class="card settings-form">
                <!-- Clinic Information Management -->
                <details class="settings-panel">
                    <summary>Clinic Information Management</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="clinic-name">Clinic Name</label>
                            <input type="text" id="clinic-name" name="clinic_name" value="{{ system_settings.get('clinic_name', 'Township Clinic') }}" required>
                        </div>
                        <div class="form-group">
                            <label for="clinic-address">Address</label>
                            <textarea id="clinic-address" name="clinic_address">{{ system_settings.get('clinic_address', '') }}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="clinic-contact">Contact Details</label>
                            <input type="text" id="clinic-contact" name="clinic_contact" value="{{ system_settings.get('clinic_contact', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="clinic-logo">Logo URL</label>
                            <input type="text" id="clinic-logo" name="clinic_logo" value="{{ system_settings.get('clinic_logo', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="branding-color">Branding Color</label>
                            <input type="color" id="branding-color" name="branding_color" value="{{ system_settings.get('branding_color', '#000000') }}">
                        </div>
                        <div class="form-group">
                            <label for="operating-hours">Operating Hours</label>
                            <input type="text" id="operating-hours" name="operating_hours" value="{{ system_settings.get('operating_hours', '9:00 AM - 5:00 PM') }}">
                        </div>
                        <div class="form-group">
                            <label for="holiday-calendar">Holiday Calendar</label>
                            <textarea id="holiday-calendar" name="holiday_calendar">{{ system_settings.get('holiday_calendar', '') }}</textarea>
                        </div>
                    </div>
                </details>

                <!-- User & Role Management -->
                <details class="settings-panel">
                    <summary>User & Role Management</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="add-user-username">Add User Username</label>
                            <input type="text" id="add-user-username" name="add_user_username">
                        </div>
                        <div class="form-group">
                            <label for="add-user-role">Role</label>
                            <select id="add-user-role" name="add_user_role">
                                <option value="admin">Admin</option>
                                <option value="doctor">Doctor</option>
                                <option value="nurse">Nurse</option>
                                <option value="receptionist">Receptionist</option>
                            </select>
                        </div>
                        <button type="submit" name="action" value="add_user" class="btn">Add User</button>
                        <div class="form-group">
                            <label for="password-policy">Password Policy</label>
                            <input type="text" id="password-policy" name="password_policy" value="{{ system_settings.get('password_policy', 'Min 8 chars') }}">
                        </div>
                        <button type="submit" name="action" value="reset_password" class="btn">Reset Password</button>
                    </div>
                </details>

                <!-- Appointment & Scheduling Settings -->
                <details class="settings-panel">
                    <summary>Appointment & Scheduling Settings</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="slot-duration">Slot Duration (mins)</label>
                            <input type="number" id="slot-duration" name="slot_duration" value="{{ system_settings.get('slot_duration', 30) }}" min="15" max="120">
                        </div>
                        <div class="form-group">
                            <label for="working-hours">Working Hours</label>
                            <input type="text" id="working-hours" name="working_hours" value="{{ system_settings.get('working_hours', '9:00 AM - 5:00 PM') }}">
                        </div>
                        <div class="form-group">
                            <label for="online-booking">Enable Online Booking</label>
                            <input type="checkbox" id="online-booking" name="online_booking" {% if system_settings.get('online_booking', False) %}checked{% endif %}>
                        </div>
                        <div class="form-group">
                            <label for="reminder-method">Automated Reminders</label>
                            <select id="reminder-method" name="reminder_method">
                                <option value="email" {% if system_settings.get('reminder_method', 'email') == 'email' %}selected{% endif %}>Email</option>
                                <option value="sms" {% if system_settings.get('reminder_method', 'email') == 'sms' %}selected{% endif %}>SMS</option>
                                <option value="both" {% if system_settings.get('reminder_method', 'email') == 'both' %}selected{% endif %}>Both</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="no-show-policy">No-Show Policy</label>
                            <textarea id="no-show-policy" name="no_show_policy">{{ system_settings.get('no_show_policy', '24-hour notice required') }}</textarea>
                        </div>
                    </div>
                </details>

                <!-- Patient Data & EHR Settings -->
                <details class="settings-panel">
                    <summary>Patient Data & EHR Settings</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="custom-fields">Custom Fields</label>
                            <textarea id="custom-fields" name="custom_fields">{{ system_settings.get('custom_fields', 'Emergency Contact') }}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="privacy-settings">Privacy Settings</label>
                            <textarea id="privacy-settings" name="privacy_settings">{{ system_settings.get('privacy_settings', 'Doctors can view/edit') }}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="data-retention">Data Retention (days)</label>
                            <input type="number" id="data-retention" name="data_retention" value="{{ system_settings.get('data_retention', 365) }}" min="30" max="3650">
                        </div>
                    </div>
                </details>

                <!-- Billing, Insurance & Financial Settings -->
                <details class="settings-panel">
                    <summary>Billing & Financial Settings</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="invoice-template">Invoice Template</label>
                            <input type="text" id="invoice-template" name="invoice_template" value="{{ system_settings.get('invoice_template', 'Default') }}">
                        </div>
                        <div class="form-group">
                            <label for="tax-rate">Tax Rate (%)</label>
                            <input type="number" id="tax-rate" name="tax_rate" value="{{ system_settings.get('tax_rate', 0) }}" step="0.1" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label for="insurance-provider">Insurance Provider</label>
                            <input type="text" id="insurance-provider" name="insurance_provider" value="{{ system_settings.get('insurance_provider', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="payment-gateway">Payment Gateway</label>
                            <input type="text" id="payment-gateway" name="payment_gateway" value="{{ system_settings.get('payment_gateway', '') }}">
                        </div>
                    </div>
                </details>

                <!-- Notification & Communication -->
                <details class="settings-panel">
                    <summary>Notification & Communication</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="email-gateway">Email Gateway</label>
                            <input type="text" id="email-gateway" name="email_gateway" value="{{ system_settings.get('email_gateway', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="sms-gateway">SMS Gateway</label>
                            <input type="text" id="sms-gateway" name="sms_gateway" value="{{ system_settings.get('sms_gateway', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="notification-template">Message Template</label>
                            <textarea id="notification-template" name="notification_template">{{ system_settings.get('notification_template', 'Reminder: Your appointment is at...') }}</textarea>
                        </div>
                    </div>
                </details>

                <!-- Security & Compliance -->
                <details class="settings-panel">
                    <summary>Security & Compliance</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="mfa">Enable MFA</label>
                            <input type="checkbox" id="mfa" name="mfa" {% if system_settings.get('mfa', False) %}checked{% endif %}>
                        </div>
                        <div class="form-group">
                            <label for="session-timeout">Session Timeout (mins)</label>
                            <input type="number" id="session-timeout" name="session_timeout" value="{{ system_settings.get('session_timeout', 30) }}" min="5" max="1440">
                        </div>
                        <div class="form-group">
                            <label for="encryption">Data Encryption</label>
                            <select id="encryption" name="encryption">
                                <option value="at_rest" {% if system_settings.get('encryption', 'at_rest') == 'at_rest' %}selected{% endif %}>At Rest</option>
                                <option value="in_transit" {% if system_settings.get('encryption', 'at_rest') == 'in_transit' %}selected{% endif %}>In Transit</option>
                                <option value="both" {% if system_settings.get('encryption', 'at_rest') == 'both' %}selected{% endif %}>Both</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="compliance">Compliance</label>
                            <select id="compliance" name="compliance">
                                <option value="hipaa" {% if system_settings.get('compliance', 'hipaa') == 'hipaa' %}selected{% endif %}>HIPAA</option>
                                <option value="gdpr" {% if system_settings.get('compliance', 'hipaa') == 'gdpr' %}selected{% endif %}>GDPR</option>
                            </select>
                        </div>
                    </div>
                </details>

                <!-- Backup & Data Management -->
                <details class="settings-panel">
                    <summary>Backup & Data Management</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="backup-frequency">Backup Frequency</label>
                            <select id="backup-frequency" name="backup_frequency">
                                <option value="daily" {% if system_settings.get('backup_frequency', 'weekly') == 'daily' %}selected{% endif %}>Daily</option>
                                <option value="weekly" {% if system_settings.get('backup_frequency', 'weekly') == 'weekly' %}selected{% endif %}>Weekly</option>
                                <option value="monthly" {% if system_settings.get('backup_frequency', 'weekly') == 'monthly' %}selected{% endif %}>Monthly</option>
                            </select>
                        </div>
                        <button type="submit" name="action" value="manual_backup" class="btn">Run Backup Now</button>
                        <button type="submit" name="action" value="restore" class="btn">Restore Backup</button>
                        <div class="form-group">
                            <label for="data-export">Data Export Format</label>
                            <input type="text" id="data-export" name="data_export" value="{{ system_settings.get('data_export', 'CSV') }}">
                        </div>
                    </div>
                </details>

                <!-- Integration & API Settings -->
                <details class="settings-panel">
                    <summary>Integration & API Settings</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="ehr-integration">EHR Integration</label>
                            <input type="text" id="ehr-integration" name="ehr_integration" value="{{ system_settings.get('ehr_integration', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="api-key">API Key</label>
                            <input type="text" id="api-key" name="api_key" value="{{ system_settings.get('api_key', '') }}">
                        </div>
                        <div class="form-group">
                            <label for="third-party">Third-Party Service</label>
                            <input type="text" id="third-party" name="third_party" value="{{ system_settings.get('third_party', '') }}">
                        </div>
                    </div>
                </details>

                <!-- Inventory & Stock Management -->
                <details class="settings-panel">
                    <summary>Inventory & Stock Management</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="stock-threshold">Low Stock Threshold</label>
                            <input type="number" id="stock-threshold" name="stock_threshold" value="{{ system_settings.get('stock_threshold', 10) }}" min="0">
                        </div>
                        <div class="form-group">
                            <label for="supplier">Supplier</label>
                            <input type="text" id="supplier" name="supplier" value="{{ system_settings.get('supplier', '') }}">
                        </div>
                    </div>
                </details>

                <div class="form-actions">
                    <button type="submit" class="btn">Save All Settings</button>
                </div>
            </form>
        </div>
    <script src="{{ url_for('static', filename='auth.js') }}"></script>
    <script src="{{ url_for('static', filename='system-settings.js') }}"></script>
{% endblock %}
{% extends "base.html" %}
{% block title %}Admin Report - Township Clinic{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h2 class="text-3xl font-bold text-center mb-8 text-primary">Admin Report Summary</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-12">
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Total Users</h3>
            <p class="text-3xl font-bold text-primary">{{ total_users }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Total Doctors</h3>
            <p class="text-3xl font-bold text-primary">{{ total_doctors }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Total Nurses</h3>
            <p class="text-3xl font-bold text-primary">{{ total_nurses }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Total Receptionists</h3>
            <p class="text-3xl font-bold text-primary">{{ total_receptionists }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Total Patients</h3>
            <p class="text-3xl font-bold text-primary">{{ total_patients }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Monthly Appointments</h3>
            <p class="text-3xl font-bold text-primary">{{ monthly_appointments_total }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Pending Appointments</h3>
            <p class="text-3xl font-bold text-primary">{{ pending_appointments }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Completed Appointments</h3>
            <p class="text-3xl font-bold text-primary">{{ completed_appointments }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Missed Appointments</h3>
            <p class="text-3xl font-bold text-primary">{{ missed_appointments }}</p>
        </div>
        <div class="stat-card bg-white rounded-lg shadow-md p-6 text-center">
            <h3 class="text-lg font-semibold mb-2">Monthly Revenue</h3>
            <p class="text-3xl font-bold text-primary">${{ monthly_revenue }}</p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
        <div class="chart-box bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4 text-center">Staff Distribution</h3>
            <canvas id="staffPieChart"></canvas>
        </div>

        <div class="chart-box bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold mb-4 text-center">Appointments Status</h3>
            <canvas id="appointmentBarChart"></canvas>
        </div>
    </div>

    <div class="chart-box full-width-chart bg-white rounded-lg shadow-md p-6">
        <h3 class="text-xl font-semibold mb-4 text-center">Monthly Appointments Trend</h3>
        <canvas id="monthlyLineChart"></canvas>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/admin_report.js') }}"></script>

<!-- Embed JSON data in non-JS script tags to avoid editor/JS parser errors -->
<script type="application/json" id="staffPieDataJson">{{ staff_pie_data_json|tojson }}</script>
<script type="application/json" id="appointmentBarDataJson">{{ appointment_bar_data_json|tojson }}</script>
<script type="application/json" id="monthlyAppointmentsDataJson">{{ monthly_appointments_data_json|tojson }}</script>

<script>
  // Read embedded JSON safely at runtime
  window.staffPieData = JSON.parse(document.getElementById('staffPieDataJson').textContent);
  window.appointmentBarData = JSON.parse(document.getElementById('appointmentBarDataJson').textContent);
  window.monthlyAppointmentsData = JSON.parse(document.getElementById('monthlyAppointmentsDataJson').textContent);
</script>
{% endblock %}
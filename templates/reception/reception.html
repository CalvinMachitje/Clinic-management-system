{% extends "base.html" %}
{% block title %}Reception Dashboard - Township Clinic{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8 dashboard-content reception-dashboard">
    <h2 class="text-3xl font-bold mb-8">Reception Dashboard</h2>
    <details class="bg-white rounded-lg shadow-md p-6 mb-8 overview-panel" open>
        <summary class="text-xl font-semibold cursor-pointer">System Overview</summary>
        <div class="panel-content mt-4">
            <ul class="space-y-2">
                <li><strong>Appointments Today:</strong> <span id="appointments-today">{{ patients_today|length }}</span></li>
                <li><strong>Total Visits (This Month):</strong> {{ all_visits|length }}</li>
                <li><strong>Available Staff:</strong> {{ available_staff|length }}</li>
                <li><strong>Walk-in Patients Waiting:</strong> {{ walkins_waiting|length }}</li>
                <li><strong>Missed Appointments:</strong> {{ missed_appointments|length }}</li>
                <li><strong>Pending Patient Registrations:</strong> {{ pending_registrations|length }}</li>
            </ul>
        </div>
    </details>

    <div class="bg-white rounded-lg shadow-md p-6 card mb-8 appointments-table">
        <h3 class="text-xl font-semibold mb-4">Today's Appointments</h3>
        <!-- Sorting Controls -->
        <div class="form-group mb-4">
            <label for="sort-appointments">Sort By</label>
            <select id="sort-appointments" class="form-control">
                <option value="all">All Appointments</option>
                <option value="scheduled">Scheduled Appointments</option>
                <option value="cancelled">Cancelled Appointments</option>
                <option value="today">Today's Appointments</option>
                <option value="week">This Week's Appointments</option>
                <option value="month">This Month's Appointments</option>
            </select>
        </div>
        {% if patients_today %}
        <table id="appointments-table" class="w-full table-auto border-collapse table">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-4 py-2 text-left">Patient ID</th>
                    <th class="px-4 py-2 text-left">Patient Name</th>
                    <th class="px-4 py-2 text-left">Appointment Time</th>
                    <th class="px-4 py-2 text-left">Reason</th>
                    <th class="px-4 py-2 text-left">Status</th>
                    <th class="px-4 py-2 text-left">Helped By</th>
                    <th class="px-4 py-2 text-left">Role</th>
                    <th class="px-4 py-2 text-left">Action</th>
                </tr>
            </thead>
            <tbody id="waiting-patients-table-body">
                {% for patient in waiting_patients %}
                <tr class="hover:bg-gray-50" data-appointment-id="{{ patient.id }}">
                    <td class="px-4 py-2">{{ patient.patient_id }}</td>
                    <td class="px-4 py-2">{{ patient.first_name }} {{ patient.last_name }}</td>
                    <td class="px-4 py-2">{{ patient.appointment_date }}</td>
                    <td class="px-4 py-2">{{ patient.reason|default('Not specified') }}</td>
                    <td class="px-4 py-2">{{ patient.status }}</td>
                    <td class="px-4 py-2">{{ patient.helper_name or 'N/A' }}</td>
                    <td class="px-4 py-2">{{ patient.helper_role or 'N/A' }}</td>
                    <td class="px-4 py-2">
                        {% if patient.status == 'scheduled' %}
                        <form action="{{ url_for('cancel_appointment') }}" method="POST" class="inline">
                            <input type="hidden" name="appointment_id" value="{{ patient.id }}">
                            <button type="submit" class="btn btn-danger">Cancel</button>
                        </form>
                        {% else %}
                        <span>{{ patient.status|capitalize }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-center text-gray-600">No appointments today.</p>
        {% endif %}
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 card mb-8 daily-summary">
        <h3 class="text-xl font-semibold mb-4">Today's Summary</h3>
        <ul class="space-y-2">
            <li><strong>Patients Checked-in:</strong> {{ checked_in_patients }}</li>
            <li><strong>Walk-ins Processed:</strong> {{ walkins_processed }}</li>
            <li><strong>Appointments Rescheduled:</strong> {{ appointments_rescheduled }}</li>
            <li><strong>Payments Processed:</strong> {{ payments_processed }}</li>
        </ul>
    </div>
    <details class="bg-white rounded-lg shadow-md p-6 notifications-panel" open>
        <summary class="text-xl font-semibold cursor-pointer">Notifications</summary>
        <div class="panel-content mt-4">
        {% if notifications %}
            <ul class="space-y-4">
                {% for note in notifications %}
                    <li class="border-b pb-2"><strong>{{ note.title }}</strong> - {{ note.message }} <small>({{ note.timestamp.strftime('%b %d, %H:%M') }})</small></li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-center text-gray-600">No new notifications.</p>
        {% endif %}
        </div>
    </details>
</div>

<script>
    // Existing script with enhancements
    // ...
</script>
{% endblock %}
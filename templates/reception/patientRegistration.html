{% extends "base.html" %}
{% block title %}Patient Search & Registration{% endblock %}


{% block content %}
<style>
/* Container to avoid content under sidebar; assuming sidebar width ~300px */
 .content-container {
    margin-left: 300px;
    max-width: 900px;
    padding: 20px;
}


/* Reduce size of all input and select boxes by ~50% */
.content-container input[type="text"],
.content-container input[type="date"],
.content-container input[type="email"],
.content-container select,
.content-container textarea {
    width: 50%; /* roughly half width */
    font-size: 0.8rem;
    padding: 4px 6px;
    box-sizing: border-box;
}


/* Reduce label font size moderately for balance */
.content-container label {
    font-size: 0.9rem;
}


/* Adjust button size slightly */
.content-container .btn {
    font-size: 0.9rem;
    padding: 0.4em 0.8em;
}


/* Responsive: On smaller screens remove margin-left */
@media (max-width: 768px) {
.content-container {
    margin-left: 0;
    width: 100%;
    padding: 10px;
}
.content-container input[type="text"],
.content-container input[type="date"],
.content-container input[type="email"],
.content-container select,
.content-container textarea {
    width: 100%;
    }
}
</style>


<div class="content-container">
<h1>Patient Search & Registration</h1>


<!-- Search Patient Form -->
<form id="search-form" method="POST" action="{{ url_for('search_patient') }}">
    {{ csrf_token() }}
         <div class="form-group">
         <label for="search_term">Search Patient by ID or Name</label>
         <input type="text" id="search_term" name="search_term" placeholder="Enter patient ID or name" value="{{ search_term | default('') }}">
    </div>
    <button type="submit" class="btn btn-primary">Search</button>
</form>


<!-- Search Results Table -->
{% if patients is defined and patients %}
<h2>Search Results</h2>
    <table class="table">
    <thead>
    <tr>
        <th>Patient ID</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Scheduled Appointment</th>
    </tr>
</thead>
    <tbody>
        {% for patient in patients %}
        <tr>
            <td>{{ patient.id }}</td>
            <td>{{ patient.first_name }}</td>
            <td>{{ patient.last_name }}</td>
            <td>
            {% if patient.appointment %}
            {{ patient.appointment.appointment_date }} ({{ patient.appointment.reason or 'No reason specified' }})
            {% else %}
            None
            {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% elif search_term is defined %}
<p>No patients found matching "{{ search_term }}". You can register a new patient below.</p>
{% endif %}


<hr>


<!-- Patient Registration Form -->
    <h2>Register New Patient</h2>
    <form id="register-form" method="POST" action="{{ url_for('add_patient') }}">
    {{ csrf_token() }}
    <div class="form-group">
        <label for="first_name">First Name *</label>
        <input type="text" id="first_name" name="first_name" required>
    </div>
    <div class="form-group">
        <label for="last_name">Last Name *</label>
        <input type="text" id="last_name" name="last_name" required>
    </div>
    <div class="form-group">
        <label for="date_of_birth">Date of Birth *</label>
        <input type="date" id="date_of_birth" name="date_of_birth" required>
    </div>
    <div class="form-group">
        <label for="gender">Gender</label>
        <select id="gender" name="gender">
        <option value="" selected disabled>Choose gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
        </select>
    </div>
    <!-- Additional fields -->
    <div class="form-group">
        <label for="address">Address</label>
        <input type="text" id="address" name="address">
    </div>
    <div class="form-group">
        <label for="phone">Phone</label>
        <input type="text" id="phone" name="phone">
    </div>
    <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email">
    </div>
    <div class="form-group">
        <label for="emergency_contact_name">Emergency Contact Name</label>
        <input type="text" id="emergency_contact_name" name="emergency_contact_name">
    </div>
    <div class="form-group">
        <label for="emergency_contact_phone">Emergency Contact Phone</label>
        <input type="text" id="emergency_contact_phone" name="emergency_contact_phone">
    </div>
    <div class="form-group">
        <label for="medical_history">Medical History</label>
        <textarea id="medical_history" name="medical_history"></textarea>
    </div>
    <div class="form-group">
        <label for="allergies">Allergies</label>
        <textarea id="allergies" name="allergies"></textarea>
        </div>
        <div class="form-group">
        <label for="current_medications">Current Medications</label>
        <textarea id="current_medications" name="current_medications"></textarea>
    </div>


    <button type="submit" class="btn btn-success">Register Patient</button>
    </form>
</div>
{% endblock %}
